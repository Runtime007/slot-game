<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="theme-color" content="#000000" />
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1" />
  <title>SlotMachine</title>
  <!-- <embed src="./sound/bgmusic.mp3" hidden="flase" autostart="true" loop="true"> -->
  <link rel="icon" href="./img/BAR.png" />
  <script src="./js/helpers.js"></script>
  <script src="./js/resource.loader.js"></script>
  <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css" />
  <link rel="stylesheet" href="./css/fontawesome-all.css" />
  <link rel="stylesheet" type="text/css" href="./css/style.css" />
</head>

<body style="background-image: url(./img/bg.jpeg); background-size:cover; background-repeat: no-repeat;">
  <iframe src="./sound/bgmusic.mp3" type="audio/mp3" allow="autoplay" id="audio" style="display:none"></iframe>
  <audio autoplay>
      <source src="./sound/bgmusic.mp3" type="audio/mp3">
  </audio>
  
  <div class="container">
    <div class="row justify-content-center mb-3">
      <img src="./img/tiger.png" style="width: 120px; position: absolute; margin-top: 95px;" />
      <img src="./img/top.png" width="435" />
    </div>
    <!-- <h2 class="text-center text-light my-3 gold"><i class="fab fa-phoenix-framework gold"></i> Slot Game</h2> -->
    <div class="row justify-content-center mb-3">
      <div style="margin-top: -45px;">
        <img src="./img/middle.png" width="450" height="375" />
        <div class="col col-auto" style="margin-top: -345px; margin-left:12px;">
          <canvas id="slot" width="385" height="340"></canvas>
        </div>
        <img src="./img/split_line.png" style="position: absolute; 
            margin-top: -349px; 
            margin-left:145px; 
            height: 344px;" />
        <img src="./img/split_line.png" style="position: absolute; 
            margin-top: -349px; 
            margin-left:290px; 
            height: 344px;" />
      </div>
      <!-- <div class="col col-auto" style="background-image: url(./img/middle.png); background-size:cover; width: 500;">
          <canvas id="slot" width="440" height="360"></canvas>
        </div> -->
    </div>
    <div class="row justify-content-center mb-3" style="margin-top: -20px;">
      <div style="background-image: url(./img/bottom.jpg); background-size:cover; height: 330px;">

        <div>
          <img src="./img/bottom_bar.png" width="435">
          <img src="./img/tips_1.png" style="position: absolute; margin-left: -370px; margin-top: 18px;" width="300">
        </div>
        <div style="display: flex; flex-direction: row; width: 435px; margin-top: 30px;">
          <div class="shadow-item">
            <img src="./img/out.png" class="img-c" width="15" height="15"></img>
            <div style="justify-content: center; display: flex">
              <input readonly type="text" class="credit-input" value="R$"
                style="text-align: end; padding-right: 0px;" />
              <input readonly class="credit-input" type="text" id="balance" min="1" max="5000"
                style="padding-left: 0px;" />
            </div>

          </div>
          <div class="shadow-item">
            <img src="./img/money.png" class="img-c" width="15" height="15"></img>
            <div style="justify-content: center; display: flex">
              <input readonly type="text" class="credit-input" value="R$"
                style="text-align: end; padding-right: 0px;" />
              <input readonly class="credit-input" type="number" id="bet" min="1" value="1" max="1000"
                style="padding-left: 0px;" />
            </div>
          </div>
          <div class="shadow-item" style="margin-right: 5px;">
            <img src="./img/win.png" class="img-c" width="15" height="15"></img>
            <div style="justify-content: center; display: flex">
              <input readonly type="text" class="credit-input" value="R$"
                style="text-align: end; padding-right: 0px;" />
              <input readonly type="text" class="credit-input" id="cwin" value="0" style="padding-left: 0px;" />
            </div>
          </div>
        </div>
      </div>
      <div style="position: absolute;  margin-top: 150px; display: flex; flex-direction: row; align-items: center;">
        <div style="display: flex;">
          <div class="img-c-dark" style="background-image: url(./img/turbo_icon.png); background-size:cover;  
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 30px;">
            <div id="turbo" style="background-image: url(./img/turbo.png); background-size:cover;
              width: 15px;
              height: 15px;">
            </div>
          </div>
          <img id="minus" class="img-c-light" src="./img/minus.png" width="40" height="40">
        </div>
        <div style="background-image: url(./img/spin_bg_1.png); 
          background-size:cover; 
          width: 93px;
          height: 100px;
          display: flex;
          align-items: center;
          justify-content: center;
          padding-bottom: 2px;
          padding-left: 1px;
          margin-left: 30px;
          margin-right: 30px;">
          <div id="spin-ani" class="rotating">
            <img id="spin" src="./img/spin-1.png" height="77.5" style="margin-bottom: 3px;">
          </div>
        </div>
        <div style="display: flex;">
          <img id="add" class="img-c-light" src="./img/add_1.png" width="40" height="40">
          <div id="auto-bg" class="img-c-light" style="background-image: url(./img/auto.png); background-size:cover;  
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 30px;">
            <div id="auto" class="img-c-light" style="background-image: url(./img/play.png); background-size:cover;
              width: 15px;
              height: 15px;">
            </div>
          </div>
        </div>
      </div>
      <div style="position: absolute;  margin-top: 250px; display: flex; flex-direction: row; align-items: center;">
        <div class="row justify-content-center my-3">
          <div class="col col-auto">
            <button class="btn btn-warning w-auto" type="button" id="checkout">
              CHECKOUT
            </button>
            <button class="btn btn-primary w-auto" type="button" data-toggle="modal" data-target="#payTable">
              Pay Table
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="row justify-content-center">
      <div class="col col-auto">
        <select id="mode" class="btn btn-default">
          <option value="random">Random</option>
          <option value="fixed">Fixed</option>
        </select>
        <select id="where" class="btn btn-default">
          <option value="top">top</option>
          <option value="middle">middle</option>
          <option value="bottom">bottom</option>
        </select>
        <select id="what" class="btn btn-default"></select>
      </div>
    </div>
  </div>

  <!-- Paytable modal -->
  <div class="modal fade" id="payTable" tabindex="-1" role="dialog" aria-labelledby="payTableTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="payTableTitle">Pay Table</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table table-dark table-hover table-responsive">
            <thead>
              <tr>
                <td>Reel1</td>
                <td>Reel2</td>
                <td>Reel3</td>
                <td>TOP</td>
                <td>MIDDLE</td>
                <td>BOTTOM</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><img src="./img/Cherry.png" width="40" /></td>
                <td><img src="./img/Cherry.png" width="40" /></td>
                <td><img src="./img/Cherry.png" width="40" /></td>
                <td class="v-align">2000xBET</td>
                <td class="v-align">1000xBET</td>
                <td class="v-align">4000xBET</td>
              </tr>
              <tr>
                <td><img src="./img/7.png" width="40" /></td>
                <td><img src="./img/7.png" width="40" /></td>
                <td><img src="./img/7.png" width="40" /></td>
                <td class="v-align">150xBET</td>
                <td class="v-align">150xBET</td>
                <td class="v-align">150xBET</td>
              </tr>
              <tr>
                <td>
                  <img src="./img/7.png" width="40" />
                  <img src="./img/Cherry.png" width="40" />
                </td>
                <td>
                  <img src="./img/7.png" width="40" />
                  <img src="./img/Cherry.png" width="40" />
                </td>
                <td>
                  <img src="./img/7.png" width="40" />
                  <img src="./img/Cherry.png" width="40" />
                </td>
                <td class="v-align">75xBET</td>
                <td class="v-align">75xBET</td>
                <td class="v-align">75xBET</td>
              </tr>
              <tr>
                <td><img src="./img/3xBAR.png" width="40" /></td>
                <td><img src="./img/3xBAR.png" width="40" /></td>
                <td><img src="./img/3xBAR.png" width="40" /></td>
                <td class="v-align">50xBET</td>
                <td class="v-align">50xBET</td>
                <td class="v-align">50xBET</td>
              </tr>
              <tr>
                <td><img src="./img/2xBAR.png" width="40" /></td>
                <td><img src="./img/2xBAR.png" width="40" /></td>
                <td><img src="./img/2xBAR.png" width="40" /></td>
                <td class="v-align">20xBET</td>
                <td class="v-align">20xBET</td>
                <td class="v-align">20xBET</td>
              </tr>
              <tr>
                <td><img src="./img/BAR.png" width="40" /></td>
                <td><img src="./img/BAR.png" width="40" /></td>
                <td><img src="./img/BAR.png" width="40" /></td>
                <td class="v-align">10xBET</td>
                <td class="v-align">10xBET</td>
                <td class="v-align">10xBET</td>
              </tr>
              <tr>
                <td>
                  <img src="./img/BAR.png" width="40" />
                  <img src="./img/2xBAR.png" width="40" />
                  <img src="./img/3xBAR.png" width="40" />
                </td>
                <td>
                  <img src="./img/BAR.png" width="40" />
                  <img src="./img/2xBAR.png" width="40" />
                  <img src="./img/3xBAR.png" width="40" />
                </td>
                <td>
                  <img src="./img/BAR.png" width="40" />
                  <img src="./img/2xBAR.png" width="40" />
                  <img src="./img/3xBAR.png" width="40" />
                </td>
                <td class="v-align">5xBET</td>
                <td class="v-align">5xBET</td>
                <td class="v-align">5xBET</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <script src="./js/reel.js"></script>
  <script src="./js/slot.js"></script>
  <script type="text/javascript">
    const conf = {
      fps: 60,
      img: [],
      width: 420 + 20,
      height: 360,
      canvas: find('#slot'),
      spinBtn: find('#spin'),
      spinAni: find('#spin-ani'),
      autoBackground: find('#auto-bg'),
      autoBtn: find('#auto'),
      mode: find('#mode'),
      where: find('#where'),
      what: find('#what'),
      balance: find('#balance'),
      bet: find('#bet'),
      win: find('#cwin'),
      checkout: find('#checkout'),
      add: find('#add'),
      minus: find('#minus'),
      reel: {
        width: 140,
        height: 240,
        stokeLineHeight: 120,
        xOffsets: [0, 140, 280].map((x) => x + 10),
        animTimes: [20, 25, 30].map((x) => x * 100),
      },
      pSkip: 40,
      imgMap: ['BAR', '2xBAR', '3xBAR', '7', 'Cherry'],
      imgStartPts: [...range(-2, 2)],
      player: {
        money: 10,
      },
      imgDot: null,
      autoModeDelay: 3000,
      sound: {
        win: new Audio('./sound/win.mp3'),
        spin: new Audio('./sound/spin.mp3'),
        bgmusic: new Audio('./sound/bgmusic.mp3'),
      },
    };

    //Resource loader
    //  Resources('./img/biaopao_1.png', './img/fudai_1.png', './img/gold_1.png', './img/hongbao_1.png', './img/yu_1.png').onLoad(
    Resources('./img/BAR.png', './img/2xBAR.png', './img/3xBAR.png', './img/7.png', './img/Cherry.png').onLoad(
      // Resources('./img/biaopao_1.png', './img/fudai_1.png', './img/gold_1.png', './img/hongbao_1.png', './img/yu_1.png').onLoad(
      function (resources, names) {
        //loading done and ready to go
        //save loaded resources to conf.img
        if (resources instanceof Array) {
          conf.imgMap.forEach((i, j) => (conf.img[i] = resources[j]));
        }
        //add options to select
        names.forEach(function (name) {
          const key = name.replace(new RegExp('^(./img/)|(.png|.jpg|.jpeg)$', 'ig'), '');
          const option = document.createElement('option');
          option.value = key;
          option.innerText = key;
          conf.what.appendChild(option);
        });

        //sounds load
        conf.sound.win.load();
        conf.sound.spin.load();
        conf.sound.bgmusic.load();

        //instantiation the game
        (function (slot) {
          let fps = conf.fps,
            interval = 1000 / fps,
            delta,
            lastpUpdate = 0;

          //bind click events
          conf.spinBtn.onclick = slot.spin;
          conf.checkout.onclick = slot.checkout;
          conf.mode.onchange = slot.setMode;
          conf.where.onchange = slot.setMode;
          conf.what.onchange = slot.setMode;
          conf.balance.onchange = slot.setCredits;
          conf.balance.value = conf.player.money;
          conf.autoBtn.onclick = slot.autoToggle;
          conf.add.onclick = slot.add;
          conf.minus.onclick = slot.minus;
          //init game
          slot.start();
          //core function of the game
          (function update(now) {
            delta = now - lastpUpdate;
            if (delta > interval) {
              lastpUpdate = now - (delta % interval);
              slot.loop(now);
            }
            window.requestAnimationFrame(update);
          })();
        })(new Slot(conf.canvas.getContext('2d')));
        (console.log('ttttt'));
      },
    );
    // var spinAni = find('#spin-ani');
    // function jiasu() {
    //   spinAni.style.animation= 'rotate 0.5s linear infinite'
    // }
    // setInterval(jiasu, 1000)
    window.onload = function () {
      console.log('window.onLoad')
      // conf.sound.bgmusic.muted = true;
      // conf.sound.bgmusic.play();
    }
  </script>

  <script src="./js/jquery-3.2.1.slim.min.js" i></script>
  <script src="./js/popper.min.js"></script>
  <script src="./js/bootstrap.min.js"></script>
</body>

</html>